#:import sm kivy.uix.screenmanager
#:import orientation plyer.orientation
ScreenManager:
    id:manager
    transition:sm.FadeTransition(duration=.0)

    MDScreen:
        name:'home'
        md_bg_color:"#C6C7C4"
        id:homes
        MDTopAppBar:
            title: "Home"
#            elevation:2
            pos_hint: {"top": 1}
            md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
            specific_text_color: "#C6C7C4"
        Admin:

    MDScreen:
        name:"guest_report"
        md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
        FloatLayout:
            MDCard:
                radius:20
                elevation:10
                size_hint:None, None
                shadow_softness:2
                size:app.size_x/1.5,app.size_y/1.9
                md_bg_color:"#C6C7C4"
                adaptive_height:True
                style:"outlined"
                adaptive_width:True
                pos_hint:{'center_x':.5, 'center_y':.5}
                orientation:"vertical"
                spacing:"10sp"
                FloatLayout:
                    MDLabel:
                        text:"Name:"+" "+app.guest_name_r
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.7}
                    MDLabel:
                        text:"Phone:"+" "+app.guest_phone
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.6}
                    MDLabel:
                        text:"Attend Time:"+" "+app.attend_time
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.5}
                    MDLabel:
                        text:"Confirmed:"
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.4}
                    MDSwitch:
                        pos_hint: {'center_x': .7, 'center_y': .4}
                        active: app.confirmed_status
                        on_active:
                            print(self.active)
                            app.guest_confirmed(self.active, app.guest_phone)


    MDScreen:
        name:'ceremony'
        md_bg_color:"#C6C7C4"
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(10)
            padding: dp(20)
            MDTopAppBar:
                title: "Create ceremony"
                elevation:2
                pos_hint: {"top": 1}
                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                specific_text_color: "#C6C7C4"

            MDLabel:
                text:"Ceremony Name"
                halign:"left"
                theme_text_color: "Secondary"
                font_name:'components/fonts/Gill Sans.otf'

            MDTextField:
                id:ceremony_name
                mode: "rectangle"
                hint_text:"Enter ceremony name"
                font_size: dp(18)
                foreground_color: 53 / 225, 59 / 225, 60 / 225, 1
                line_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                fill_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                hint_text_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                text_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                halign: 'left'

            MDLabel:
                text:"Guest Name"
                halign:"left"
                theme_text_color: "Secondary"
                font_name:'components/fonts/Gill Sans.otf'
            MDTextField:
                id:guest_name
                mode: "rectangle"
                hint_text:"Enter guest name"
                foreground_color: 53 / 225, 59 / 225, 60 / 225, 1
                line_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                fill_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                hint_text_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                text_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                font_size: dp(18)
                halign: 'left'

            MDLabel:
                text:"Guest Number"
                halign:"left"
                theme_text_color: "Secondary"
                font_name:'components/fonts/Gill Sans.otf'

            NumberOnlyField:
                id:guest_number
                mode: "rectangle"
                hint_text:"Enter guest number"
                foreground_color: 53 / 225, 59 / 225, 60 / 225, 1
                line_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                fill_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                hint_text_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                text_color_focus: 53 / 225, 59 / 225, 60 / 225, 1
                font_size: dp(18)
                halign: 'left'
            MDChip:
                on_release:
                    app.toggle_double(self)
                type:"filter"
                id:isDouble
                md_bg_color:"#303A29"
                MDChipText:
                    text: "Double"

#                text:"HEllo"
#                text_color: "white"
#                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
            MDRaisedButton:
                text:"Submit"
                md_bg_color:  53 / 225, 59 / 225, 60 / 225, 1
                text_color: "#FFFFFF"
                font_name:'components/fonts/Gill Sans.otf'
                on_release:
                    print("submit")
                    app.get_guest( guest_number.text, guest_name.text, ceremony_name.text, isDouble.active)
                    app.add_attender_opt()
            MDLabel:
                text: "Please fill in all the details"
                theme_text_color: "Hint"
                halign: "center"

    MDScreen:
        name:"detail_scanner"
        md_bg_color:"#C6C7C4"
        on_enter:
            app.get_details()
        on_leave:
            app.stop_camera_detail()
        MDBoxLayout:
            orientation: "vertical"
            spacing: dp(10)
            padding: dp(20)

            MDTopAppBar:
                title: "Detail Scanner"
                elevation:2
                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                specific_text_color: "#C6C7C4"

            Scan_Analyze:
                extracted_data:app.get_QRcode
                id:details_scan

            MDLabel:
                text:"Scanned Code"
                halign:"center"
                theme_text_color: "Secondary"
                font_name:'components/fonts/Gill Sans.otf'
            MDTextField:
                id:pda
                mode: "rectangle"
                hint_text:"Scanned Code"
                font_size: dp(18)
                color_mode: 'custom'
                line_color_focus: "#C6C7C4"

            MDFillRoundFlatIconButton:
                icon:"arrow-right"
                text:"Capture code"
                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                text_color: "#FFFFFF"
                font_name:'components/fonts/Gill Sans.otf'
                on_release:
                    print("Ma")
                    app.screen_capture("Confirm")
                    app.get_data()

    MDScreen:
        name:"Confirm"
        md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
        FloatLayout:
            MDCard:
                radius:20
                elevation:10
                size_hint:None, None
                shadow_softness:2
                size:app.size_x/1.5,app.size_y/1.9
                md_bg_color:"#C6C7C4"
                adaptive_height:True
                style:"outlined"
                adaptive_width:True
                pos_hint:{'center_x':.5, 'center_y':.5}
                orientation:"vertical"
                spacing:"10sp"
                FloatLayout:
                    MDLabel:
                        text:pda.text
                        halign:"center"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.5, 'center_y':.9}
                    MDLabel:
                        text:"Name:"+" "+app.guest_fetch_name
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.7}
                    MDLabel:
                        text:"Phone:"+" "+app.guest_fetch_phone
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.6}
                    MDLabel:
                        text:"Scanned:"+" "+app.guest_scanned
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.5}
                    MDLabel:
                        text:"Card Type:"+" "+app.guest_type
                        halign:"left"
                        theme_text_color: "Secondary"
                        font_size:"18sp"
                        size_hint_y: None
                        pos_hint:{'center_x':.6, 'center_y':.4}
                    MDRaisedButton:
                        text:"Confirm"
                        md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                        text_color: "#FFFFFF"
                        pos_hint:{"center_x":.5, "center_y":.18}
                        on_release:
                            print("submit")
                            app.scan_user_optimize()
    MDScreen:
        name:"reports"
        md_bg_color:"#C6C7C4"
        on_enter:
            app.ceremony_report_optimize()
        MDBoxLayout:
            orientation: "vertical"
            spacing: dp(10)
            padding: dp(20)
            MDTopAppBar:
                title: "Report"
                elevation:1
                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                specific_text_color: "#C6C7C4"
            MDBoxLayout:
                orientation:"vertical"
                MDFloatLayout:
                    Carry:
                        pos_hint:{"center_x":.5, "center_y":.77}
                        MDFloatLayout:
                            MDLabel:
                                text:"Attendance"
                                halign:"center"
                                color:"white"
                                pos_hint:{"center_x":.15, "center_y":.82}
                            MDLabel:
                                text:app.total_guest
                                halign:"left"
                                color:"white"
                                font_size:"30sp"
                                pos_hint:{"center_x":.6, "center_y":.5}
                            MDLabel:
                                text:"Confirmed Attendance"
                                halign:"center"
                                color:"white"
                                pos_hint:{"center_x":.6, "center_y":.82}
                            MDLabel:
                                text:app.total_confirmed
                                halign:"left"
                                color:"white"
                                font_size:"30sp"
                                pos_hint:{"center_x":.9, "center_y":.5}

                    Display:
                        name:"Yet to attend"
                        number:str(int(app.total_guest) - int(app.total_attended))
                        posx:.45
                        pos_hint:{"center_x":.27, "center_y":.46}

                    Display:
                        name:"Attended"
                        number:app.total_attended
                        pos_hint:{"center_x":.72, "center_y":.46}

                    MDLabel:
                        text:"Quick Actions"
                        color:"#474747"
                        font_size:"18sp"
                        halign:"center"
                        pos_hint:{"center_x":.22, "center_y":.32}

                    MDFloatingActionButton:
                        icon: "account-group"
                        type:"standard"
                        md_bg_color:"#2e4052"
                        text_color:"#BCDCDC"
                        pos_hint:{"center_x":.2, "center_y":.26-.02}
                        on_release:
                            app.data_getter = 'all_guests'
                            app.screen_capture("data_screen")
                            app.title_data = "All Guest"
                            app.load_contacts_to_ui()

                    MDLabel:
                        text:"All Guest"
                        color:"#474747"
                        font_size:"12sp"
                        halign:"center"
                        pos_hint:{"center_x":.2, "center_y":.19-.02}

                    MDFloatingActionButton:
                        icon: "account-arrow-down"
                        type:"standard"
                        md_bg_color:"#2e4052"
                        text_color:"#BCDCDC"
                        pos_hint:{"center_x":.4+.05, "center_y":.26-.02}
                        on_release:
                            app.data_getter = 'attended_guests'
                            app.screen_capture("data_screen")
                            app.title_data = "Attended Guest"
                            app.load_contacts_to_ui()

                    MDLabel:
                        text:"Attended"
                        color:"#474747"
                        font_size:"12sp"
                        halign:"center"
                        pos_hint:{"center_x":.4+.05, "center_y":.19-.02}

                    MDFloatingActionButton:
                        icon: "account-alert"
                        type:"standard"
                        md_bg_color:"#2e4052"
                        text_color:"#BCDCDC"
                        pos_hint:{"center_x":.6+.1, "center_y":.26-.02}
                        on_release:
                            app.data_getter = 'not_attended'
                            app.screen_capture("data_screen")
                            app.title_data = "Not Attended"
                            app.load_contacts_to_ui()
                    MDLabel:
                        text:"Not attended"
                        color:"#474747"
                        font_size:"12sp"
                        halign:"center"
                        pos_hint:{"center_x":.6+.1, "center_y":.19-.02}

                    MDFloatingActionButton:
                        icon: "account-check"
                        type:"standard"
                        md_bg_color:"#2e4052"
                        text_color:"#BCDCDC"
                        pos_hint:{"center_x":.32, "center_y":.1}
                        on_release:
                            app.data_getter = 'confirmed_guest'
                            app.screen_capture("data_screen")
                            app.title_data = "Confirmed Guest"
                            app.load_contacts_to_ui()

                    MDLabel:
                        text:"Confirmed"
                        font_size:"12sp"
                        halign:"center"
                        pos_hint:{"center_x":.32, "center_y":.04}

                    MDFloatingActionButton:
                        icon: "account-cancel"
                        type:"standard"
                        md_bg_color:"#2e4052"
                        text_color:"#BCDCDC"
                        pos_hint:{"center_x":.6, "center_y":.1}
                        on_release:
                            app.data_getter = 'not_confirmed_guest'
                            app.screen_capture("data_screen")
                            app.title_data = "Not Confirmed"
                            app.load_contacts_to_ui()

                    MDLabel:
                        text:"Not Confirmed"
                        font_size:"12sp"
                        halign:"center"
                        pos_hint:{"center_x":.6, "center_y":.04}

    MDScreen:
        name:"not_attended"
        MDBoxLayout:
            MDTopAppBar:
                title: "Not Attended"
                elevation:2
                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                specific_text_color: "#C6C7C4"
            ScrollView:
                MDList:
                    id: report_list
    MDScreen:
        name:"data_screen"
        MDBoxLayout:
            orientation:"vertical"
            MDTopAppBar:
                title: app.title_data
                elevation:2
                md_bg_color: 53 / 225, 59 / 225, 60 / 225, 1
                specific_text_color: "#C6C7C4"
            MDTextField:
                id:guest_search
                hint_text: "Search Guest"
                mode: "round"
                helper_text: "Massage"
                on_text:
                    app.search_data(guest_search.text)
            RecycleView:
                id:guests
                key_viewclass: 'viewclass'
                key_size: 'height'
                RecycleBoxLayout:
                    id:wali
                    spacing:dp(10)
                    padding: dp(10)
                    default_size: None, dp(70)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation:"vertical"
    MDScreen:
        name: "story"
        on_enter:
            app.storey()
        ScrollView:
            bar_color: [0.2, 0.5, 0.8, 1]  # Scroll bar color
            bar_inactive_color: [0.6, 0.7, 0.9, 0.5]  # Inactive scroll bar color
            effect_cls: "ScrollEffect"  # Scroll effect
            scroll_type: ['bars', 'content']  # Scroll type

            MDBoxLayout:
                size_hint_y: None
                height: self.minimum_height  # This will allow the layout to grow as text is added.

                MDLabel:
                    id: story_label
                    text: app.story  # Your story text goes here
                    theme_text_color: "Custom"
                    text_color: [0.411, 0.352, 0.282, 1]  # Book-like color
                    font_style: "Body1"
                    halign: "center"
                    size_hint_y: None
                    height: self.texture_size[1]
                    pos_hint: {"center_x": .5}


<Front>:
    radius:20
    #height:240
    elevation:3
    size_hint:None, None
    shadow_softness:2
    size:app.size_x/3,app.size_y/6
    md_bg_color:80 / 225, 136 / 225, 225 / 225, 1
    adaptive_height:True
    style:"outlined"
    adaptive_width:True

<Spin>:
    adaptive_height: True
    spacing: dp(5)
    MDSpinner:
        size_hint: None, None
        size: dp(25), dp(25)
        pos_hint: {'center_x': .5, 'center_y': 1}
        active: True
        color: 78 / 255, 82 / 255, 84 / 255, 1
    MDLabel:
        text:'Loading...'
        bold:True
        font_name:'components/fonts/Gill Sans.otf'
        theme_text_color: "Custom"
        text_color:78/255, 82/255, 84/255, 1
        pos_hint: {'center_x': .5, 'center_y': 1}

<Admin>:
    MDCard:
        radius:20
        #height:240
        elevation:3
        size_hint:None, None
        shadow_softness:2
        size:app.size_x/3,app.size_y/6
        md_bg_color:53 / 225, 59 / 225, 60 / 225, 1
        adaptive_height:True
        style:"outlined"
        adaptive_width:True
        pos_hint:{'center_x':.5, 'center_y':.7}
        on_release:
            app.screen_capture("detail_scanner")
        FloatLayout:
            MDIcon:
                icon:"qrcode-scan"
                #halign:"center"
                font_size:"60sp"
                pos_hint: {"center_x": .5, "center_y": .6}
            MDLabel:
                text:"Scan Qrcode"
                halign:"center"
                text_color:"#C6C7C4"
                theme_text_color:"Custom"
                pos_hint: {"center_x": .5, "center_y": .15}
                font_name:'components/fonts/Gill Sans.otf'
    MDCard:
        radius:20
        #height:240
        elevation:3
        size_hint:None, None
        shadow_softness:2
        size:app.size_x/3,app.size_y/6
        md_bg_color:53 / 225, 59 / 225, 60 / 225, 1
        adaptive_height:True
        style:"outlined"
        adaptive_width:True
        pos_hint:{'center_x':.5, 'center_y':.4}
        on_release:
            app.screen_capture("ceremony")
        FloatLayout:
            MDIcon:
                icon:"account-multiple-plus-outline"
                #halign:"center"
                font_size:"60sp"
                pos_hint: {"center_x": .5, "center_y": .6}
            MDLabel:
                text:"Create ceremony"
                halign:"center"
                text_color:"#C6C7C4"
                theme_text_color:"Custom"
                pos_hint: {"center_x": .5, "center_y": .15}
                font_name:'components/fonts/Gill Sans.otf'

<Ceremony>:
    MDCard:
        radius:20
        elevation:3
        size_hint:None, None
        shadow_softness:2
        size:app.size_x/3,app.size_y/6
        md_bg_color:53 / 225, 59 / 225, 60 / 225, 1
        adaptive_height:True
        style:"outlined"
        adaptive_width:True
        pos_hint:{'center_x':.5, 'center_y':.5}
        on_release:
            app.screen_capture("reports")
        FloatLayout:
            MDIcon:
                icon:"clipboard-text"
                font_size:"60sp"
                pos_hint: {"center_x": .5, "center_y": .6}
            MDLabel:
                text:"Reports"
                halign:"center"
                text_color:"#C6C7C4"
                theme_text_color:"Custom"
                pos_hint: {"center_x": .5, "center_y": .15}
                font_name:'components/fonts/Gill Sans.otf'
<Display@MDBoxLayout>:
	md_bg_color:"#BCDCDC"
	orientation:"vertical"
	radius:dp(20)
	#adaptive_height:True
	size_hint:None, None
	size:app.size_x/2.9,app.size_y/6
	posx:.4
	name:""
	number:""
	FloatLayout:
		MDLabel:
			text:root.name
			halign:"center"
			font_size:"17sp"
			color:"#2e4052"
			pos_hint:{'center_x':root.posx, 'center_y':.75}
		MDLabel:
			text:root.number
			halign:"left"
			color:"#2e4052"
			font_size:"30sp"
			pos_hint:{'center_x':.9, 'center_y':.4}

<Carry@MDCard>:
	md_bg_color:"#2e4052"
	orientation:"vertical"
	radius:dp(28)
	adaptive_height:True
#	height:"1"
	size_hint:None, None
	size:app.size_x/1.2,app.size_y/4

<Contacts>:
	text: root.name
    secondary_text: "Whatsapp status:"+" "+root.whatsapp_status
    tertiary_text: "Normal sms:"+" "+root.normal_status
	font_name:'components/fonts/Gill Sans.otf'
	style:"elevated"
	elevation:3
	on_release:
	    print(root.phone)
	    app.guest_report(root.phone)
	    app.screen_capture('guest_report')
	ImageLeftWidget:
	    source:root.image
	    radius: [dp(50), dp(50), dp(50), dp(50)]
	    on_release:
            print(root.phone)
    CallContainer:
        MDIconButton:
            icon: "phone"
            on_release:
                app.call(root.phone)
